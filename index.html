<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PRIMED Risk Reduction Management Training Services Certificate Verifier</title>

  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #e3f2fd, #ffffff);
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .container {
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 12px 35px rgba(0,0,0,0.15);
      padding: 32px;
      width: 95%;
      max-width: 540px;
      text-align: center;
    }
    .logo {
      width: 110px;
      margin-bottom: 12px;
    }
    h1 {
      font-size: 20px;
      color: #0d6efd;
      margin-bottom: 10px;
    }
    .description {
      font-size: 13.5px;
      color: #333;
      margin-bottom: 22px;
      line-height: 1.5;
    }
    select, input {
      width: 85%;
      padding: 10px;
      margin-bottom: 14px;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    .btn {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
    }
    .btn-primary {
      background: linear-gradient(90deg, #0d6efd, #084298);
      color: #fff;
    }
    .btn-secondary {
      background: #f1f1f1;
      color: #333;
    }
    #qr-reader {
      width: 90%;
      max-width: 300px;
      margin: 20px auto;
      display: none;
    }
    #result {
      margin-top: 20px;
      text-align: left;
      background: #f8f9fa;
      padding: 15px;
      border-radius: 12px;
      border: 1px solid #ddd;
      font-size: 14px;
      max-height: 280px;
      overflow-y: auto;
    }
    .result-note {
      margin-top: 8px;
      font-size: 11.5px;
      color: #666;
      line-height: 1.4;
    }
    .valid { color: green; font-weight: 600; }
    .invalid { color: red; font-weight: 600; }
  </style>
</head>

<body>
  <div class="container">
    <img src="https://raw.githubusercontent.com/PRIMED-RRM/primedrrmverifier/refs/heads/main/PRIMED%20Logo%201.png"
         alt="PRIMED Logo" class="logo">

    <h1>PRIMED Risk Reduction Management Training Services Certificate Verifier</h1>

    <p class="description">
      <b>PRIMED Risk Reduction Management Training Services</b> is the official training arm of
      <b>ACER – Fire Rescue & Communication, Inc.</b>, a SEC-registered organization.
    </p>

    <select id="trainingFilter">
      <option value="">All Trainings</option>
      <option value="STOP THE BLEED">Stop The Bleed</option>
      <option value="Basic Life Support">Basic Life Support</option>
      <option value="Standard First Aid">Standard First Aid</option>
      <option value="Basic First Aid">Basic First Aid</option>
      <option value="Hands-Only CPR">Hands-Only CPR</option>
      <option value="Introductory to DRRM">Introductory to DRRM</option>
      <option value="Fire Safety Seminar">Fire Safety Seminar</option>
      <option value="Earthquake Preparedness">Earthquake Preparedness</option>
    </select>

    <input type="text" id="certInput" placeholder="Enter Your Certificate Number">

    <div>
      <button class="btn btn-primary" onclick="verifyCert()">Verify</button>
      <button class="btn btn-secondary" id="openScannerBtn">Open QR Scanner</button>
      <button class="btn btn-secondary" id="toggleFlashBtn">Toggle Flashlight</button>
    </div>

    <div id="qr-reader"></div>

    <div id="result"></div>
    <div class="result-note">
      This verification result is based on records issued by PRIMED Risk Reduction Management Training Services.
      Validity confirms participation and completion of the indicated training only and does not constitute
      professional licensure or government accreditation.
    </div>

    <audio id="beep-sound"
      src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"
      preload="auto"></audio>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbyEKx6AzEjRdPjeYUMjhOZNXtv0ybC7vgukImCW5qK76YZV8dT2CStaOUc5XvX_0flhEw/exec";

    let qr;
    let torch = false;

    function verifyCert(inputValue) {
      const cert = inputValue || document.getElementById("certInput").value.trim();
      const filter = document.getElementById("trainingFilter").value;
      const resultDiv = document.getElementById("result");

      if (!cert) {
        resultDiv.innerHTML = "<span class='invalid'>Enter your certificate number</span>";
        return;
      }

      resultDiv.textContent = "Checking...";

      fetch(API_URL + "?cert=" + encodeURIComponent(cert))
        .then(res => res.json())
        .then(data => {
          if (data.found) {
            if (filter && data.training !== filter) {
              resultDiv.innerHTML = "<span class='invalid'>Certificate does not match selected training ❌</span>";
              return;
            }
            resultDiv.innerHTML = `
              <span class='valid'>YOUR CERTIFICATE IS VALID ✅</span><br><br>
              <b>Name:</b> ${data.name}<br>
              <b>Certificate Number:</b> ${data.certificate}<br>
              <b>Training Date:</b> ${new Date(data.date).toLocaleDateString()}<br>
              <b>Training Venue:</b> ${data.venue}<br>
              <b>Training:</b> ${data.training}
            `;
          } else {
            resultDiv.innerHTML = "<span class='invalid'>Certificate not found ❌</span>";
          }
        })
        .catch(() => {
          resultDiv.innerHTML = "<span class='invalid'>Error connecting to server</span>";
        });
    }

    function onScanSuccess(text) {
      document.getElementById("beep-sound").play();
      if (navigator.vibrate) navigator.vibrate(200);

      qr.stop().then(() => {
        document.getElementById("qr-reader").style.display = "none";
        document.getElementById("certInput").value = text;
        verifyCert(text);
      });
    }

    document.getElementById("openScannerBtn").onclick = () => {
      const reader = document.getElementById("qr-reader");

      if (reader.style.display === "block") {
        qr.stop().then(() => reader.style.display = "none");
        return;
      }

      reader.style.display = "block";
      qr = new Html5Qrcode("qr-reader");

      qr.start(
        { facingMode: "environment" }, // BACK CAMERA
        { fps: 10, qrbox: 250 },
        onScanSuccess
      );
    };

    document.getElementById("toggleFlashBtn").onclick = () => {
      if (!qr) return;
      torch = !torch;
      qr.applyVideoConstraints({ advanced: [{ torch: torch }] })
        .catch(() => console.log("Flashlight not supported"));
    };

    document.getElementById("certInput").addEventListener("keydown", e => {
      if (e.key === "Enter") verifyCert();
    });
  </script>
</body>
</html>
