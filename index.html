<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRIMED Certificate Verifier</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>

<style>
:root {
  --bg-color: #e3f2fd;
  --card-bg: #ffffff;
  --text-color: #333;
  --primary-color: #0d6efd;
  --secondary-color: #084298;
}
[data-theme="dark"] {
  --bg-color: #121212;
  --card-bg: #1e1e1e;
  --text-color: #eee;
  --primary-color: #0d6efd;
  --secondary-color: #084298;
}

* { box-sizing: border-box; margin:0; padding:0; }

html, body { height: 100%; margin:0; padding:0; }

body {
  font-family: 'Roboto', sans-serif;
  background: var(--bg-color);
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  min-height: 100vh;
  align-items: center;
}

.container {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 95%;
  max-width: 500px;
  text-align: center;
  padding: 20px 20px 30px;
  background: var(--card-bg);
  border-radius: 18px;
  box-shadow: 0 12px 35px rgba(0,0,0,0.15);
}

.logo-wrap {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 16px;
  margin-bottom: 14px; /* restored original position */
  flex-wrap: wrap;
}
.logo-wrap img { height: 60px; max-width: 45%; object-fit: contain; }

.org-title { font-size: 12px; font-weight: 500; letter-spacing:1px; color: #555; margin-bottom:6px; }
.main-title { font-size: 20px; font-weight:700; color: var(--primary-color); margin-bottom:18px; }

.description { font-size: 13px; color: var(--text-color); margin-bottom:18px; line-height:1.4; }

select, input {
  width: 100%;
  padding: 10px;
  margin-bottom: 12px;
  border-radius: 10px;
  border: 1px solid #ccc;
  font-size: 14px;
}

.btn {
  padding: 10px 18px;
  margin: 5px;
  border: none;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
}
.btn-primary { background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); color: #fff; }
.btn-secondary { background: #f1f1f1; color: #333; }

#qr-reader { width: 100%; max-width: 300px; margin: 12px 0; display: none; }
#result {
  margin-top: 12px;
  width: 100%;
  text-align: left;
  background: #f8f9fa;
  padding: 15px;
  border-radius: 12px;
  border: 1px solid #ddd;
  font-size: 14px;
  max-height: 260px;
  overflow-y: auto;
}

.result-note { margin-top: 10px; font-size: 12.5px; color: #555; line-height:1.4; }
.valid { color: green; font-weight: 600; }
.invalid { color: red; font-weight: 600; }

#toggleThemeBtn {
  margin-top: 10px;
  padding: 8px 16px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  background: var(--primary-color);
  color: #fff;
  font-weight: 500;
}

footer {
  text-align: center;
  padding: 12px 10px;
  font-size: 12px;
  color: #555;
  width: 100%;
}
</style>
</head>

<body data-theme="light">

<div class="container">

  <div class="logo-wrap">
    <img src="https://raw.githubusercontent.com/PRIMED-RRM/primedrrmverifier/refs/heads/main/PRIMED%20Logo%201.png" alt="PRIMED Logo">
    <img src="https://raw.githubusercontent.com/PRIMED-RRM/primedrrmverifier/refs/heads/main/BackgroundEraser_20251102_093006990.png" alt="ACER Logo">
  </div>

  <div class="org-title">PRIMED RISK REDUCTION MANAGEMENT TRAINING SERVICES</div>
  <div class="main-title">CERTIFICATE VERIFIER</div>

  <p class="description">
    PRIMED is the official training arm of <b>ACER – Fire Rescue & Communication, Inc.</b> providing preparedness and life-saving training programs.
  </p>

  <select id="trainingFilter">
    <option value="">All Trainings</option>
    <option value="STOP THE BLEED">Stop The Bleed</option>
    <option value="Basic Life Support">Basic Life Support</option>
    <option value="Standard First Aid">Standard First Aid</option>
    <option value="Basic First Aid">Basic First Aid</option>
    <option value="Hands-Only CPR">Hands-Only CPR</option>
    <option value="Introductory to DRRM">Introductory to DRRM</option>
    <option value="Fire Safety Seminar">Fire Safety Seminar</option>
    <option value="Earthquake Preparedness">Earthquake Preparedness</option>
  </select>

  <input type="text" id="certInput" placeholder="Enter Your Certificate Number">

  <div>
    <button class="btn btn-primary" onclick="verifyCert()">Verify</button>
    <button class="btn btn-secondary" id="openScannerBtn">QR Scan</button>
    <button class="btn btn-secondary" id="toggleFlashBtn">Open Flashlight</button>
  </div>

  <div id="qr-reader"></div>
  <div id="result"></div>

  <div class="result-note">
    Verification results are based on official PRIMED training records.
    This confirms participation and completion only and does not imply government licensure or professional accreditation.
  </div>

  <button id="toggleThemeBtn">TLight/Dark Mode</button>
</div>

<footer>
  &copy; 2025 All Rights Reserved | PRIMED RRMTS<br>
  acerfrci@gmail.com | +63 946 247 6586
</footer>

<audio id="beep-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyEKx6AzEjRdPjeYUMjhOZNXtv0ybC7vgukImCW5qK76YZV8dT2CStaOUc5XvX_0flhEw/exec";
let qr, torch=false;

function verifyCert(inputValue){
  const cert = inputValue || document.getElementById("certInput").value.trim();
  const filter = document.getElementById("trainingFilter").value;
  const resultDiv = document.getElementById("result");
  if(!cert){ resultDiv.innerHTML="<span class='invalid'>Enter your certificate number</span>"; return; }
  resultDiv.textContent="Checking...";
  fetch(`${API_URL}?cert=${encodeURIComponent(cert)}`, {cache:"no-store"})
    .then(res=>res.json())
    .then(data=>{
      if(data.found){
        if(filter && data.training!==filter){
          resultDiv.innerHTML="<span class='invalid'>Certificate does not match selected training ❌</span>";
          return;
        }
        resultDiv.innerHTML=`<span class='valid'>YOUR CERTIFICATE IS VALID ✅</span><br><br>
          <b>Name:</b> ${data.name}<br>
          <b>Certificate Number:</b> ${data.certificate}<br>
          <b>Training Date:</b> ${new Date(data.date).toLocaleDateString()}<br>
          <b>Training Venue:</b> ${data.venue}<br>
          <b>Training:</b> ${data.training}`;
        const beep=document.getElementById("beep-sound");
        beep.volume=1.0;
        beep.play();
        if(navigator.vibrate) navigator.vibrate([300,200,300]);
      } else resultDiv.innerHTML="<span class='invalid'>Certificate not found ❌</span>";
    }).catch(()=>resultDiv.innerHTML="<span class='invalid'>Error connecting to server</span>");
}

function onScanSuccess(text){
  const beep=document.getElementById("beep-sound");
  beep.volume=1.0;
  beep.play();
  if(navigator.vibrate) navigator.vibrate([300,200,300]);
  qr.stop().then(()=>{
    document.getElementById("qr-reader").style.display="none";
    document.getElementById("certInput").value=text;
    verifyCert(text);
  });
}

// Open QR Scanner button
document.getElementById("openScannerBtn").onclick=()=>{
  const reader=document.getElementById("qr-reader");
  if(reader.style.display==="block"){ qr.stop().then(()=>reader.style.display="none"); return; }
  reader.style.display="block";
  qr=new Html5Qrcode("qr-reader");
  qr.start(
    { facingMode: { exact: "environment" } }, // always back camera
    { fps: 15, qrbox: 250 },
    onScanSuccess
  );
};

// Toggle flashlight
document.getElementById("toggleFlashBtn").onclick=()=>{
  if(!qr) return;
  torch=!torch;
  qr.applyVideoConstraints({advanced:[{torch:torch}]}).catch(()=>console.log("Flashlight not supported"));
};

document.getElementById("certInput").addEventListener("keydown", e=>{ if(e.key==="Enter") verifyCert(); });

document.getElementById("toggleThemeBtn").addEventListener("click", ()=>{
  const body=document.body;
  body.dataset.theme=body.dataset.theme==="light"?"dark":"light";
});
</script>

</body>
</html>
