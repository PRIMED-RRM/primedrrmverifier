<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PRIMED Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  margin:0;
  padding:20px;
}
h1{margin-bottom:5px}
.card{
  background:#fff;
  padding:15px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
  margin-bottom:20px;
}
input,select,button{
  padding:8px;
  margin:5px 0;
  width:100%;
}
button{
  background:#111;
  color:#fff;
  border:none;
  cursor:pointer;
}
button:hover{opacity:.85}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ddd;
  padding:8px;
  text-align:left;
}
th{
  background:#222;
  color:#fff;
}
.badge{
  background:green;
  color:white;
  padding:3px 8px;
  border-radius:12px;
  font-size:12px;
}
.stats{
  display:flex;
  gap:15px;
}
.stat{
  flex:1;
  background:#111;
  color:#fff;
  padding:15px;
  border-radius:8px;
  text-align:center;
}
.delete-btn{
  background:red;
  padding:5px 10px;
}
</style>
</head>

<body>

<h1>PRIMED Admin Dashboard</h1>
<p>Training Records Management</p>

<!-- ðŸ“Š ANALYTICS -->
<div class="stats">
  <div class="stat">
    <h2 id="totalTrainees">0</h2>
    <p>Total Trainees</p>
  </div>
  <div class="stat">
    <h2 id="totalTrainings">0</h2>
    <p>Trainings Types</p>
  </div>
</div>

<!-- âž• ADD TRAINEE -->
<div class="card">
<h3>âž• Add Trainee</h3>

<input id="name" placeholder="Participant Name">
<input id="certificate" placeholder="Certificate Number">
<input id="training" placeholder="Training Type">
<input id="venue" placeholder="Training Venue">
<input id="date" type="date">

<button onclick="addTrainee()">Add Trainee</button>
</div>

<!-- ðŸ“‹ TRAINEES LIST -->
<div class="card">
<h3>ðŸ“‹ Trainees List</h3>

<table>
<thead>
<tr>
  <th>Name</th>
  <th>Certificate #</th>
  <th>Training</th>
  <th>Venue</th>
  <th>Date</th>
  <th>Status</th>
  <th>Action</th>
</tr>
</thead>
<tbody id="traineesBody"></tbody>
</table>
</div>

<script>
/* ðŸ”¥ PASTE YOUR APPS SCRIPT WEB APP URL HERE */
const API_URL = "https://script.google.com/macros/s/AKfycbwR761OUftq--nN23Ll6RGItQXYMAnJgDAXZWSjUVRDVqw8F1gxT2n45xnZMC4WyymoxQ/exec";

/* âž• ADD */
function addTrainee(){
  const data = {
    name: name.value,
    certificate: certificate.value,
    training: training.value,
    venue: venue.value,
    date: date.value
  };

  if(!data.name || !data.certificate){
    alert("Name and Certificate required");
    return;
  }

  fetch(API_URL + "?add=1",{
    method:"POST",
    body: JSON.stringify(data)
  })
  .then(res=>res.json())
  .then(r=>{
    if(r.success){
      alert("Trainee Added");
      loadTrainees();
    }else{
      alert("Error adding trainee");
    }
  });
}

/* ðŸ“‹ LOAD LIST */
<script>
function loadTrainees(){
  fetch(API_URL + "?list=1")
  .then(res => res.json())
  .then(data => {

    // ðŸ”§ SUPPORT ALL POSSIBLE BACKEND FORMATS
    const trainees =
      data.trainees || data.data || data.records || data;

    const tbody = document.getElementById("traineesBody");
    tbody.innerHTML = "";

    if(!Array.isArray(trainees) || trainees.length === 0){
      tbody.innerHTML = "<tr><td colspan='7'>No trainees found</td></tr>";
      return;
    }

    trainees.reverse(); // newest first

    document.getElementById("totalTrainees").innerText = trainees.length;
    document.getElementById("totalTrainings").innerText =
      new Set(trainees.map(t=>t.training)).size;

    trainees.forEach(t=>{
      tbody.innerHTML += `
        <tr>
          <td>${t.name || ""}</td>
          <td>${t.certificate || ""}</td>
          <td>${t.training || ""}</td>
          <td>${t.venue || ""}</td>
          <td>${t.date || ""}</td>
          <td><span class="badge">VALID</span></td>
          <td>
            <button class="delete-btn"
              onclick="deleteTrainee('${t.certificate}')">Delete</button>
          </td>
        </tr>`;
    });
  })
  .catch(err=>{
    alert("LIST ERROR â€” check API");
    console.error(err);
  });
}
</script>

    // newest â†’ oldest
    data.trainees.reverse();

    document.getElementById("totalTrainees").innerText = data.trainees.length;
    document.getElementById("totalTrainings").innerText =
      new Set(data.trainees.map(t=>t.training)).size;

    data.trainees.forEach(t=>{
      tbody.innerHTML += `
        <tr>
          <td>${t.name}</td>
          <td>${t.certificate}</td>
          <td>${t.training}</td>
          <td>${t.venue}</td>
          <td>${t.date}</td>
          <td><span class="badge">VALID</span></td>
          <td>
            <button class="delete-btn"
              onclick="deleteTrainee('${t.certificate}')">Delete</button>
          </td>
        </tr>`;
    });
  });
}

/* ðŸ—‘ DELETE */
function deleteTrainee(cert){
  if(!confirm("Delete this trainee?")) return;

  fetch(API_URL + "?delete=1&cert=" + encodeURIComponent(cert))
  .then(res=>res.json())
  .then(r=>{
    if(r.success){
      loadTrainees();
    }else{
      alert("Delete failed");
    }
  });
}

window.onload = loadTrainees;
</script>

</body>
</html>
