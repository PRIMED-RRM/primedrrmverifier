<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PRIMED Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{
  font-family:Roboto;
  background:#0f172a;
  color:#e5e7eb;
  margin:0;
}
.container{
  max-width:420px;
  margin:auto;
  padding:20px;
}
.card{
  background:#020617;
  padding:20px;
  border-radius:12px;
  box-shadow:0 0 15px rgba(0,0,0,.4);
}
input,button,select{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
  border:none;
  font-size:15px;
}
button{
  background:#16a34a;
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
button.secondary{
  background:#334155;
}
.hidden{display:none}
.status{
  margin-top:15px;
  padding:10px;
  border-radius:8px;
  font-weight:500;
}
.success{background:#064e3b}
.error{background:#7f1d1d}
</style>
</head>

<body>
<div class="container">

<!-- LOGIN -->
<div class="card" id="loginCard">
<h3>üîê ADMIN LOGIN</h3>
<input type="password" id="adminPass" placeholder="Enter Admin Password">
<button onclick="login()">Login</button>
<div id="loginMsg" class="status hidden"></div>
</div>

<!-- ADMIN PANEL -->
<div class="card hidden" id="adminPanel">
<h3>üì∑ QR SCAN CERTIFICATE</h3>

<div id="reader" style="width:100%"></div>

<input id="manualCert" placeholder="Or enter certificate number">
<button onclick="verifyAdmin()">Verify</button>
<button class="secondary" onclick="logout()">Logout</button>

<div id="adminResult" class="status"></div>
</div>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzKD0Z8iehv0op_Wg_yGo9ro9kumHDYqTdYXYNUE1sY3vtiXVzENrwOdga3n2kETWdL/exec";
const ADMIN_PASSWORD = "PRIMED-ADMIN-2025";

let scanner;

function login(){
  const p = document.getElementById("adminPass").value;
  const msg = document.getElementById("loginMsg");

  if(p === ADMIN_PASSWORD){
    document.getElementById("loginCard").classList.add("hidden");
    document.getElementById("adminPanel").classList.remove("hidden");
    startScanner();
  }else{
    msg.textContent = "INVALID PASSWORD ‚ùå";
    msg.className = "status error";
    msg.classList.remove("hidden");
  }
}

function logout(){
  location.reload();
}

function startScanner(){
  scanner = new Html5Qrcode("reader");
  scanner.start(
    { facingMode:"environment" },
    { fps:10, qrbox:250 },
    txt=>{
      scanner.stop();
      document.getElementById("manualCert").value = txt;
      verifyAdmin();
    }
  );
}

function verifyAdmin(){
  const cert = document.getElementById("manualCert").value.trim().toUpperCase();
  const res = document.getElementById("adminResult");

  if(!cert){
    res.textContent = "ENTER CERTIFICATE NUMBER ‚ùå";
    res.className="status error";
    return;
  }

  res.textContent = "Verifying‚Ä¶";

  fetch(API_URL)
    .then(r=>r.json())
    .then(data=>{
      const rec = data.find(x =>
        x.certificate &&
        x.certificate.toUpperCase().trim() === cert
      );

      if(!rec){
        res.textContent = "CERTIFICATE NOT FOUND ‚ùå";
        res.className="status error";
        return;
      }

      res.innerHTML = `
        <b>VALID CERTIFICATE ‚úÖ</b><br><br>
        Name: ${rec.name}<br>
        Training: ${rec.training}<br>
        Date: ${rec.date}<br>
        Venue: ${rec.venue}
      `;
      res.className="status success";
    })
    .catch(()=>{
      res.textContent = "SERVER ERROR ‚ùå";
      res.className="status error";
    });
}
</script>
</body>
</html>
